## 멤버 클래스는 되도록 static으로 만들라



중첩 클래스란 다른 클래스 안에 정의된 클래스를 말한다. 중첩 클래스는 자신을 감싼 바깥 클래스에서만 쓰여야 하며 그 외의 쓰임새가 있다면 톱레벨 클래스로 만들어야 한다. 중첩 클래스의 종류는 정적 멤버 클래스, 익명 클래스, 지역 클래스, 이렇게 네 가지다. 이번 아이템에서는 각각의 중첩 클래스를 언제 그리고 왜 사용해야 하는지 이야기한다.

먼저 간단한 정적 멤버 클래스를 알아보자. 정적 멤버 클래스는 다른 클래스 안에 선언되고, 바깥의 클래스의 private 변수에 접근할 수 있다는 점만 제외하면 일반 클래스와 동일하다.

정적 멤버 클래스와 비정적 멤버 클래스는 구문 상에서 차이는 static이 붙냐 안 붙냐의 차이를 가지고 있고, 의미상에서는 꽤 큰 차이를 가지고 있다. 비정적 멤버 클래스는 바깥 클래스의 인스턴스와 암묵적으로 연결된다. 그래서 비정적 멤버 클래스의 인스턴스 메서드에서 정규화된 this를 사용해 바깥 인스턴스의 메서드를 호출하거나 바깥 인스턴스의 참조를 가져올 수 있다.

따라서 개념상 중첩 클래스의 인스턴스가 바깥 인스턴스와 독립적으로 존재할 수 있다면 정적 멤버 클래스로 만들어야 한다. 왜냐하면 비정적 멤버 클래스는 바깥 인스턴스 생성없이는 만들 수 없기 때문이다.

비정적 멤버 클래스는 Class.new Member Class()를 호출해서 만들 수도 있지만 이 방법은 시간도 더 걸릴 뿐더라 비정적 멤버클래스 인스턴스 안에 만들어져 메모리 공간을 차지한다.

```java
public class MySet<E> extends AbstractSet<E> {
    ...
    @Override public Iterator<E> iterator() {
        return new MyIterator();
    }
    
    private class MyIterator implements Iterator<E> {
        ...
    }
}
```

멤버 클래스에서 바깥 인스턴스에 접근할 일이 없다면 무조건  static을 붙여서 정적 멤버 클래스로 만들자 !!! static을 생략하면 바깥 인스턴스의 숨은 외부 참조를 갖게 된다. 그러면 참조를 저장하려면 시간과 공간이 소비된다. 더 심각한 문제는 가비지 컬렉션이 바깥 클래스의 인스턴스를 수거하지 못하면 메모리 누수가 발생하게 된다.



#### 핵심 정리

>중첩 클래스에는 네 가지가 있으며, 각각의 쓰임이 다르다. 메서드 밖에서도 사용해야 하거나 메서드 안에 정의하기엔 너무 길다면 멤버 클래스로 만든다. 멤버 클래스의 인스턴스 각각이 바깥 인스턴스를 참조한다면 비정적으로, 그렇지 않으면 정적으로 만들자. 중첩 클래스가 한 메서드 안에서만 쓰이면서 그 인스턴스를 생성하는 지점이 단 한 곳이고 해당 타입으로 쓰기에 적합한 클래스나 인터페이스가 이미 있다면 익명 클래스로 만들고, 그렇지 않으면 지역 클래스로 만들자.